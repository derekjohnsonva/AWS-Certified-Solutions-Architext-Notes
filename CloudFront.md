A Content Delivery Network (CDN) in AWS

Key Terms
Origin - source location of your content
	Either an S3 Origin or Custom Origin
	You would have 1 or more
	You can create a group of Origins
Distribution = the configuration unit of CloudFront
Behavior = pattern matching on path so that origins can route to different Origins
	This is also where TTL and Access Controls are configured
Edge Location = local cache of data
Regional Edge Cache - Larger version of edge location

Flow of how to use...
In the Distribution, you would set an Origin as well as a endpoint. CloudFront will chose a default domain name (CNAME) for you (ending in `.cloudfront.net`) but you can also supply your own.
Next, you would deploy your Distribution to Edge Locations.
Now, when users make a request they will be routed to an edge location (Routing is done by the DNS).
If the edge has the data, we will download it.
If it does not the user will be routed to a Regional Edge Cache. 
If the Regional Edge Cache does not have that data, we perform a Origin fetch.
	The regional fetch will update the data in both the Regional Edge Cache and the Edge Location

## Behaviors
Any request to the endpoint will be routed through the behavior that it is pattern matched to
Every Distribution has a Default Behavior (`/*`)
You can set the cache settings in the behavior
	you can cache based on headers
	set the TTL
	You can restrict viewer access. Restrict with signers (cookies) or key groups.

TTL
	The default TTL is 24 hours
	You can set Min TTL and Max TTL
	You can also set a Cache Control max-age (seconds), Cache-Control s-maxage (seconds), and Expires (Data & Time). The Min and Max TTL will be used instead of these values if they do not agree.
Invalidation = immediately makes everything that it effects result in a cache miss
	Applied to a distribution.
Normally, we don't like using invalidation. Instead, we should update the object names using versioned file names.
## Access Control
CloudFront signed URLs and signed cookies allow us to control who can access our content (Private Distributions)
Signed URLs use cases:
* [RTMP](https://en.wikipedia.org/wiki/Real-Time_Messaging_Protocol) distribution (signed cookies aren't supported for RTMP distributions).
* Restrict access to individual files (e.g. an installation download for your application).
* Users are using a client that doesn't support cookies.
Signed Cookies use cases:
* Provide access to multiple restricted files (e.g. all of the files for a video in HLS format or all of the files in the subscribers' area of a website).
* We don't want to change our current URLs.
The old way of signing Cookies or URLs was to use CloudFront Key created by the Account Root User and adding the account as a Trusted Signer
The new way is to use Trusted Key Groups
### SSL
if you are using an alternate domain name from the one that was autogenerated you will need to verify ownership using a Certificate
Best way is probably to use [[AWS Certificate Manager|ACM]] (but it has to be generated in `us-east-1`)
You should probably chose to only accept HTTPS connections

You will make 2 connections if using a certification
1) Connection from Viewer to CloudFront
2) Connection from CloudFront to Origin
We can not use a self signed cert

If you need to support [SNI](https://www.cloudflare.com/learning/ssl/what-is-sni/) (a legacy browser thing), you have to pay extra

### Origin Access Identity (OAI)
A type of identity that can be associated with CloudFront Distributions
Basically, CloudFront can become that OAI
S3 buckets will then only allow access from that OAI
This prevents users from accessing the S3 bucket directly

If we want to secure our custom origins so that only CF can access them, we can either attach Custom Headers or use a Firewall
### Origin Access Control
OAC allows more precise control over access to S3 objects by leveraging AWS Identity and Access Management (IAM) policies, providing more flexibility compared to OAI.

## Lambda@Edge
Lets you run lightweight lambda functions at edge locations
They will not have the full feature set
You can not use a VPC

![[Pasted image 20241001125058.png | 400]]
Use Cases
* A/B testing - Viewer Request
* Migrating between S3 Origins - Origin Request
* Different objects based on device - Origin Request
* Content by country - Viewer Response